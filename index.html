<!DOCTYPE html>  <html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="preconnect" href="https://fonts.googleapis.com">  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>  
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Oswald:wght@500;700&display=swap" rel="stylesheet">  
    <title>MemePublishing</title>  
    <link rel="stylesheet" href="css/style.css">   
</head>  
<body>  <header class="header-dark-style-centered" id="home">
    <div class="header-top-row">
        <div class="header-left-area">
            <a class="site-title">MEME PUBLISHING</a>
        </div>

        <div class="logo-center">
           <a href="#home" class="logo-text">#MEMEMANIA</a>
        </div>

        <div class="header-right-area">
            <nav class="nav-links-dark">
                <a href="#gallery-start">–ì–ê–õ–ï–†–ï–Ø</a>
                <a href="#generator-start">–ì–ï–ù–ï–†–ê–¢–û–†</a>
                <a href="#MemeSite" id="nav-about-link">–û –°–ê–ô–¢–ï</a>
            </nav>
            <a href="#login" class="login-button-dark">–í–û–ô–¢–ò</a>
        </div>
    </div>

    <div class="header-search-container">
        <input type="text" id="meme-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –∏–ª–∏ —Ç–µ–≥ –¥–ª—è –ø–æ–∏—Å–∫–∞...">
        <button id="search-btn">–ò—Å–∫–∞—Ç—å</button>
        <div id="search-message" class="search-message">
            –°–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. üê¶
        </div>
    </div>
</header>  

<section class="intro-section-dark">  
    <div class="intro-content-wrapper">  
          
        <div class="intro-header-content">  
            <div class="intro-text-area">  
                <h1 class="intro-hashtag">#MemeGallery</h1>  
                <p class="intro-description">  
                    –ì–∞–ª–µ—Ä–µ—è –æ—Ç–±–æ—Ä–Ω—ã—Ö –º–µ–º–æ–≤, –æ—Ç–æ–±—Ä–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ—Å—Ç–≤–æ–º.<br>  
                    –ù–∞–π–¥–∏—Ç–µ, –≤–¥–æ—Ö–Ω–æ–≤–∏—Ç–µ—Å—å –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ —Å–≤–æ–π —à–µ–¥–µ–≤—Ä.  
                </p>  
            </div>  
      <div class="filter-bar">  
<button class="filter-btn active-filter" data-sort="views">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</button>  
<button class="filter-btn" data-sort="likes">–õ–∞–π–∫–∏</button>

</div>  
        </div>  
    </section>  <main class="meme-main-content">  
    <div id="gallery-start"></div>   
    <section class="meme-gallery">  
          
<div class="meme-row">  
    <div class="meme-card" data-views="1200" data-likes="450">  
        <img src="gallery/0u6b801ff1-1e3d4d53-c18f0260.jpg">  
        <div class="card-footer">  
            <span class="views">üëÅÔ∏è 1 249</span>  
            <span class="likes">üëç 450</span>  
        </div>  
          
        <div class="card-tags">  
            <a href="#tag-cats" class="tag-link">#–ü—Å–∏—Ö–æ–ø–∞—Ç—ã—á</a>  
            <a href="#tag-reaction" class="tag-link">#–ú–µ–º</a>  
            <a href="#tag-classic" class="tag-link">#–°–º–µ—à–Ω—è–≤–∫–∞</a>  
        </div>  
    </div>  

    <div class="meme-card" data-views="800" data-likes="210">  
        <img src="gallery/images.jpeg">  
        <div class="card-footer">  
            <span class="views">üëÅÔ∏è 800</span>  
            <span class="likes">üëç 489</span>  
        </div>  
        <div class="card-tags">  
            <a href="#tag-dev" class="tag-link">#–ú–µ–º</a>  
            <a href="#tag-fail" class="tag-link">#–ü—Å–µ—Ö—É—à–∫–∞</a>  
            <a href="#tag-fail" class="tag-link">#–ü–µ—Å</a>  
        </div>  
    </div>  
      
    <div class="meme-card" data-views="1100" data-likes="578">  
        <img src="gallery/images.jpg.png">  
        <div class="card-footer">  
            <span class="views">üëÅÔ∏è 1 238</span>  
            <span class="likes">üëç 887</span>  
        </div>  
        <div class="card-tags">  
            <a href="#tag-dev" class="tag-link">#–æ—Ä–µ—à–∫–∏ –±–∏–≥ –±–æ–±</a>  
            <a href="#tag-fail" class="tag-link">#–ú–µ–º</a>  
            <a href="#tag-fail" class="tag-link">#–ë–µ—à–∞–Ω–∞—è –±–µ–ª–∫–∞</a>  
        </div>  
    </div>  
      
    <div class="meme-card" data-views="987" data-likes="343">  
        <img src="gallery/PolishCowMeme.jpg">  
        <div class="card-footer">  
            <span class="views">üëÅÔ∏è 987</span>  
            <span class="likes">üëç 120</span>  
        </div>  
        <div class="card-tags">  
            <a href="#tag-dev" class="tag-link">#–ü–æ–ª—å—Å–∫–∞—è –∫–æ—Ä–æ–≤–∞</a>  
            <a href="#tag-fail" class="tag-link">#2022 –≥–æ–¥</a>  
            <a href="#tag-fail" class="tag-link">#–°–º–µ—à–Ω—è–≤–∫–∞</a>  
        </div>  
    </div>  
</div>  
  
<div class="meme-row hidden-row">  
    <div class="meme-card" data-views="768" data-likes="255"><img src="gallery/hehe.jpg">  
        <div class="card-footer"><span class="views">üëÅÔ∏è 768</span><span class="likes">üëç 675</span></div>  
        <div class="card-tags"><a href="#" class="tag-link">#–ö–æ—Ç—ã</a></div>  
    </div>  
    <div class="meme-card" data-views="555" data-likes="134"><img src="gallery/chill guy.jpeg">  
        <div class="card-footer"><span class="views">üëÅÔ∏è 555</span><span class="likes">üëç 134</span></div>  
        <div class="card-tags"><a href="#" class="tag-link">#—á–∏–ª–ª–æ–≤—ã–π –ø–∞—Ä–µ–Ω—å</a></div>  
    </div>  
    <div class="meme-card" data-views="2200" data-likes="1500"><img src="gallery/pesik.jpg">  
        <div class="card-footer"><span class="views">üëÅÔ∏è 2 344</span><span class="likes">üëç 1 561</span></div>  
        <div class="card-tags"><a href="#" class="tag-link">#–ü–µ—Å</a></div>  
    </div>  
    <div class="meme-card" data-views="3400" data-likes="2500"><img src="gallery/sozvon.jpg">  
        <div class="card-footer"><span class="views">üëÅÔ∏è 3 433</span><span class="likes">üëç 1 478</span></div>  
        <div class="card-tags"><a href="#" class="tag-link">#—Å–æ–∑–≤–æ–Ω</a></div>  
    </div>  
</div>  
  
<div class="meme-row hidden-row">  
    <div class="meme-card" data-views="947" data-likes="679"><img src="gallery/tatarstan.jpg">  
        <div class="card-footer"><span class="views">üëÅÔ∏è 947</span><span class="likes">üëç 679</span></div>  
        <div class="card-tags"><a href="#" class="tag-link">#–ø–æ–ø—É–≥–∞–π</a></div>  
    </div>  
    <div class="meme-card" data-views="4800" data-likes="3200"><img src="gallery/umnii.jpeg">  
        <div class="card-footer"><span class="views">üëÅÔ∏è 4 809</span><span class="likes">üëç 2 345</span></div>  
        <div class="card-tags"><a href="#" class="tag-link">#—É–º–Ω—ã–π —á–µ–ª–æ–≤–µ–∫ –≤ –æ—á–∫–∞—Ö</a></div>  
    </div>  
    <div class="meme-card" data-views="768" data-likes="431"><img src="gallery/shrek.jpeg">  
        <div class="card-footer"><span class="views">üëÅÔ∏è 768</span><span class="likes">üëç 231</span></div>  
        <div class="card-tags"><a href="#" class="tag-link">#—à—Ä–µ–∫</a></div>  
        <div class="card-tags"><a href="#" class="tag-link">#–º–µ–∫—Å–∏–∫–∞–Ω—Å–∫–∏–π —à—Ä–µ–∫</a></div>  
    </div>  
    <div class="meme-card" data-views="1100" data-likes="900"><img src="gallery/kot.jpeg">  
        <div class="card-footer"><span class="views">üëÅÔ∏è 1 112</span><span class="likes">üëç 900</span></div>  
        <div class="card-tags"><a href="#" class="tag-link">#–ö–æ—Ç—ã</a></div>  
    </div>  
</div>  
  
<div class="meme-row hidden-row">  
    <div class="meme-card" data-views="725" data-likes="455"><img src="gallery/zhak.jpg">  
        <div class="card-footer"><span class="views">üëÅÔ∏è 725</span><span class="likes">üëç 155</span></div>  
        <div class="card-tags"><a href="#" class="tag-link">#–ñ–∞–∫ –§—Ä–µ—Å–∫–æ</a></div>  
    </div>  
    <div class="meme-card" data-views="2500" data-likes="1300"><img src="gallery/jarvis.jpeg">  
        <div class="card-footer"><span class="views">üëÅÔ∏è 2 567</span><span class="likes">üëç 2 355</span></div>  
        <div class="card-tags"><a href="#" class="tag-link">#–¥–∂–∞—Ä–≤–∏—Å</a></div>  
    </div>  
    <div class="meme-card" data-views="122" data-likes="55"><img src="gallery/lisiy.jpeg">  
        <div class="card-footer"><span class="views">üëÅÔ∏è 122</span><span class="likes">üëç 55</span></div>  
        <div class="card-tags"><a href="#" class="tag-link">#–ª—ã—Å—ã–π</a></div>  
    </div>  
    <div class="meme-card" data-views="1900" data-likes="1000"><img src="gallery/leto.jpeg">  
        <div class="card-footer"><span class="views">üëÅÔ∏è 1 999</span><span class="likes">üëç 1 120</span></div>  
        <div class="card-tags"><a href="#" class="tag-link">#—á–∏—Å—Ç–æ –Ω–∞ –ª–µ—Ç–æ</a></div>  
    </div>  
</div>

</section>  
    </main>  <section class="load-more-section">  
    <a href="javascript:void(0)" id="load-more-btn" class="load-more-button">  
        –ó–ê–ì–†–£–ó–ò–¢–¨ –ï–©–Å –ú–ï–ú–´  
    </a>  
</section>  

<div id="lightbox" class="lightbox">  
    <span class="close-btn">&times;</span>  
    <img class="lightbox-content" id="lightbox-img" src="">  
</div>  

<section class="generator-section" id="generator-start">  
    <div class="generator-content-wrapper">  
        <h1 class="generator-hashtag">#MemeGenerator</h1>  
          
        <div class="meme-editor-container">  
            <div class="editor-controls">  
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>  

          <div class="control-group">  
                    <label for="image-upload" class="control-label">–§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</label>  
                    <input type="file" id="image-upload" accept="image/*">  
                    <button id="clear-canvas-btn" class="editor-btn delete-btn">–û—á–∏—Å—Ç–∏—Ç—å —Ö–æ–ª—Å—Ç</button>  
                </div>  

                <div class="control-group">  
                    <label for="top-text" class="control-label">–í–µ—Ä—Ö–Ω–∏–π —Ç–µ–∫—Å—Ç:</label>  
                    <input type="text" id="top-text" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–µ—Ä—Ö–Ω–∏–π —Ç–µ–∫—Å—Ç">  
                </div>  

                <div class="control-group">  
                    <label for="bottom-text" class="control-label">–ù–∏–∂–Ω–∏–π —Ç–µ–∫—Å—Ç:</label>  
                    <input type="text" id="bottom-text" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∂–Ω–∏–π —Ç–µ–∫—Å—Ç">  
                </div>  

                <div class="control-group text-settings">  
                    <label for="text-color" class="control-label">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞:</label>  
                    <input type="color" id="text-color" value="#FFFFFF">  
                      
                    <label for="font-size" class="control-label">–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞:</label>  
                    <input type="range" id="font-size" min="20" max="100" value="48">  
                      
                    <label for="font-family" class="control-label">–®—Ä–∏—Ñ—Ç:</label>  
                    <select id="font-family">  
                        <option value="Impact">Impact</option>  
                        <option value="Arial">Arial</option>  
                        <option value="Verdana">Verdana</option>  
                        <option value="Oswald">Oswald</option>  
                        <option value="Montserrat">Montserrat</option>  
                    </select>  
                </div>  

                <div class="control-group drawing-tools">  
                    <label class="control-label">–†–∏—Å–æ–≤–∞–Ω–∏–µ:</label>  
                    <div class="drawing-buttons">  
                        <button id="toggle-draw-btn" class="editor-btn draw-btn">–í–∫–ª—é—á–∏—Ç—å/–í—ã–∫–ª—é—á–∏—Ç—å</button>  
                        <input type="color" id="draw-color" value="#FF0000">  
                        <input type="range" id="draw-width" min="1" max="20" value="5">  
                        <button id="undo-draw-btn" class="editor-btn">–û—Ç–º–µ–Ω–∏—Ç—å</button>  
                    </div>  
                </div>  

                <div class="control-group download-group">  
                    <button id="download-meme-btn" class="editor-btn download-btn">–°–∫–∞—á–∞—Ç—å</button>  
                </div>  
            </div>  

            <div class="canvas-area">  
                <canvas id="memeCanvas"></canvas>  
            </div>  
        </div>  
    </div>  
</section>

<section id="MemeSite" class="generator-section">  
    <div class="generator-content-wrapper">  
        <h2 class="generator-hashtag">#MemeSite</h2>  
        <div class="meme-editor-container" style="display: block; padding: 30px;">  
            <p style="font-size: 18px; color: var(--text-color-secondary); margin-bottom: 15px;">  
                –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ **MemeMania** ‚Äî –∏–¥–µ–∞–ª—å–Ω—ã–π —Å–∞–π—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–º–æ–≤!  
            </p>  
            <p style="font-size: 16px; color: var(--text-color-primary);">  
                –Ø —Å–æ–∑–¥–∞–ª —ç—Ç—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –≤—Å–µ—Ö, –∫—Ç–æ –ª—é–±–∏—Ç –º–µ–º—ã. –ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ —Å–∞–º—ã–µ —Å–º–µ—à–Ω—ã–µ –∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ–º—ã, –Ω–æ –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —à–µ–¥–µ–≤—Ä—ã —Å –ø–æ–º–æ—â—å—é –Ω–∞—à–µ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞. –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Ç–µ–∫—Å—Ç –∏ –¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º —é–º–æ—Ä–æ–º —Å–æ –≤—Å–µ–º –º–∏—Ä–æ–º!  
            </p>  
        </div>  
    </div>  
</section>  
 <script>
document.addEventListener('DOMContentLoaded', () => {

    /* === –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø –ü–õ–ê–í–ù–ê–Ø –ü–†–û–ö–†–£–¢–ö–ê (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ë–õ–û–ö) === */
    document.querySelectorAll('a[href^="#"]').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');

            // –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –≤–µ–¥–µ—Ç –Ω–∞ # –∏–ª–∏ #home, –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –Ω–∞ —Å–∞–º—ã–π –≤–µ—Ä—Ö (0, 0)
            if (!targetId || targetId === '#' || targetId === '#home') {
                window.scrollTo({ top: 0, behavior: 'smooth' });
                return;
            }

            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    });
    // ====================================================================

    /* === –ì–∞–ª–µ—Ä–µ—è === */
    const galleryContainer = document.querySelector('.meme-gallery');
    const loadMoreBtn = document.getElementById('load-more-btn');
    const allCardsArray = Array.from(document.querySelectorAll('.meme-card'));
    const cardsPerRow = 4;
    const totalRows = Math.ceil(allCardsArray.length / cardsPerRow);
    const rowsPerClick = 2;
    let currentVisibleRows = 1;
    let currentSort = document.querySelector('.filter-btn.active-filter')?.dataset.sort || 'views';

    const rebuildGallery = (sortBy, rowsToKeepVisible) => {
        allCardsArray.sort((a, b) => parseInt(b.dataset[sortBy]) - parseInt(a.dataset[sortBy]));
        galleryContainer.innerHTML = '';
        const rowsToShow = Math.min(rowsToKeepVisible, totalRows);

        for (let i = 0; i < totalRows; i++) {
            const newRow = document.createElement('div');
            newRow.classList.add('meme-row');
            if (i >= rowsToShow) newRow.classList.add('hidden-row');
            allCardsArray.slice(i * cardsPerRow, i * cardsPerRow + cardsPerRow)
                         .forEach(card => newRow.appendChild(card));
            galleryContainer.appendChild(newRow);
        }

        if (loadMoreBtn) {
            if (rowsToShow >= totalRows) loadMoreBtn.classList.add('hidden');
            else loadMoreBtn.classList.remove('hidden');
        }
    };

    if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', () => {
            currentVisibleRows += rowsPerClick;
            rebuildGallery(currentSort, currentVisibleRows);
        });
    }

    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active-filter'));
            btn.classList.add('active-filter');
            currentSort = btn.dataset.sort;
            currentVisibleRows = 1;
            rebuildGallery(currentSort, currentVisibleRows);
        });
    });

    rebuildGallery(currentSort, currentVisibleRows);

    /* === Lightbox === */
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightbox-img");
    const closeBtn = document.querySelector(".close-btn");

    allCardsArray.forEach(card => {
        const img = card.querySelector('img');
        img.addEventListener('click', () => {
            lightbox.style.display = "flex";
            lightboxImg.src = img.src;
        });
    });

    if (closeBtn) {
        closeBtn.addEventListener('click', () => lightbox.style.display = "none");
    }
    
    window.addEventListener('click', e => {
        if (e.target === lightbox) lightbox.style.display = "none";
    });

    /* === –ü–æ–∏—Å–∫ === */
    const searchInput = document.getElementById('meme-search');
    const searchBtn = document.getElementById('search-btn');
    const searchMessage = document.getElementById('search-message');

    const showSearchMessage = () => {
        searchMessage.classList.add('visible');
        setTimeout(() => searchMessage.classList.remove('visible'), 1000);
    };

    const executeSearch = () => {
        const query = searchInput.value.trim().toLowerCase().replace(/#/g, '');
        searchMessage.classList.remove('visible'); // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –Ω–æ–≤–æ–º –ø–æ–∏—Å–∫–µ
        if (!query) return;

        let foundCard = null;
        let foundTag = null;

        for (const card of allCardsArray) {
            const tags = card.querySelectorAll('.tag-link');
            for (const tag of tags) {
                if (tag.textContent.toLowerCase().replace(/#/g, '').includes(query)) {
                    foundCard = card;
                    foundTag = tag;
                    break;
                }
            }
            if (foundCard) break;
        }

        if (foundCard) {
            const index = allCardsArray.indexOf(foundCard);
            const rowsNeeded = Math.ceil((index + 1) / cardsPerRow);
            if (rowsNeeded > currentVisibleRows) {
                currentVisibleRows = rowsNeeded;
                rebuildGallery(currentSort, currentVisibleRows);
            }

            setTimeout(() => {
                // –°–∫—Ä–æ–ª–ª –∫ –Ω–∞–π–¥–µ–Ω–Ω–æ–º—É —Ç–µ–≥—É –∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–µ
                (foundTag || foundCard).scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        } else showSearchMessage();
    };

    searchBtn.addEventListener('click', executeSearch);
    searchInput.addEventListener('keydown', e => { if (e.key === 'Enter') executeSearch(); });

    /* === –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–µ–º–æ–≤ (Canvas) === */
    const memeCanvas = document.getElementById('memeCanvas');
    const ctx = memeCanvas.getContext('2d');
    const imageUpload = document.getElementById('image-upload');
    const clearCanvasBtn = document.getElementById('clear-canvas-btn');
    const topTextInput = document.getElementById('top-text');
    const bottomTextInput = document.getElementById('bottom-text');
    const textColorInput = document.getElementById('text-color');
    const fontSizeInput = document.getElementById('font-size');
    const fontFamilySelect = document.getElementById('font-family');
    const toggleDrawBtn = document.getElementById('toggle-draw-btn');
    const drawColorInput = document.getElementById('draw-color');
    const drawWidthInput = document.getElementById('draw-width');
    const undoDrawBtn = document.getElementById('undo-draw-btn');
    const downloadMemeBtn = document.getElementById('download-meme-btn');

    let originalImage = null, drawHistory = [], drawingEnabled = false, isDrawing = false, lastX = 0, lastY = 0;

    memeCanvas.width = 600;
    memeCanvas.height = 400;

    const drawMeme = () => {
        ctx.clearRect(0, 0, memeCanvas.width, memeCanvas.height);

        if (originalImage) {
            let w = originalImage.width, h = originalImage.height;
            const ratio = w / h;
            const maxW = 800, maxH = 600;

            // –õ–æ–≥–∏–∫–∞ –ø–æ–¥–≥–æ–Ω–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–¥ canvas (–≤–∞—à–∞ –ª–æ–≥–∏–∫–∞ –±—ã–ª–∞ —Å–ª–µ–≥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ fit)
            if (w > maxW || h > maxH) {
                if (w / maxW > h / maxH) {
                    w = maxW;
                    h = w / ratio;
                } else {
                    h = maxH;
                    w = h * ratio;
                }
            } else {
                // –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ–Ω—å—à–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä
                if (originalImage.width > maxW) { w = maxW; h = w / ratio; }
                if (originalImage.height > maxH) { h = maxH; w = h * ratio; }
            }
            
            memeCanvas.width = w;
            memeCanvas.height = h;

            const x = 0; // –¢–µ–ø–µ—Ä—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–Ω–∏–º–∞–µ—Ç –≤–µ—Å—å canvas
            const y = 0;
            ctx.drawImage(originalImage, x, y, w, h);
        } else {
            memeCanvas.width = 600;
            memeCanvas.height = 400;
        }


        // –†–∏—Å–æ–≤–∞–Ω–∏–µ
        drawHistory.forEach(path => {
            ctx.strokeStyle = path.color;
            ctx.lineWidth = path.width;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.beginPath();
            if (path.points.length > 0) {
                 ctx.moveTo(path.points[0].x, path.points[0].y);
                 path.points.forEach(p => ctx.lineTo(p.x, p.y));
            }
            ctx.stroke();
        });

        // –¢–µ–∫—Å—Ç
        ctx.font = `bold ${fontSizeInput.value}px ${fontFamilySelect.value}`;
        ctx.fillStyle = textColorInput.value;
        ctx.strokeStyle = 'black';
        ctx.lineWidth = parseInt(fontSizeInput.value) / 16;
        ctx.textAlign = 'center';

        // –í–µ—Ä—Ö–Ω–∏–π —Ç–µ–∫—Å—Ç (—Å –æ–±–≤–æ–¥–∫–æ–π)
        if (topTextInput.value) {
            ctx.strokeText(topTextInput.value, memeCanvas.width / 2, parseInt(fontSizeInput.value) + 20);
            ctx.fillText(topTextInput.value, memeCanvas.width / 2, parseInt(fontSizeInput.value) + 20);
        }
        
        // –ù–∏–∂–Ω–∏–π —Ç–µ–∫—Å—Ç (—Å –æ–±–≤–æ–¥–∫–æ–π)
        if (bottomTextInput.value) {
            ctx.strokeText(bottomTextInput.value, memeCanvas.width / 2, memeCanvas.height - 20);
            ctx.fillText(bottomTextInput.value, memeCanvas.width / 2, memeCanvas.height - 20);
        }
    };

    imageUpload.addEventListener('change', e => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = ev => {
            const img = new Image();
            img.onload = () => { originalImage = img; drawHistory = []; drawMeme(); };
            img.src = ev.target.result;
        };
        reader.readAsDataURL(file);
    });

    clearCanvasBtn.addEventListener('click', () => { originalImage = null; drawHistory = []; drawMeme(); });
    topTextInput.addEventListener('input', drawMeme);
    bottomTextInput.addEventListener('input', drawMeme);
    textColorInput.addEventListener('input', drawMeme);
    fontSizeInput.addEventListener('input', drawMeme);
    fontFamilySelect.addEventListener('change', drawMeme);

    toggleDrawBtn.addEventListener('click', () => {
        drawingEnabled = !drawingEnabled;
        toggleDrawBtn.classList.toggle('active-draw', drawingEnabled);
        memeCanvas.style.cursor = drawingEnabled ? 'crosshair' : 'default';
        isDrawing = false;
    });

    undoDrawBtn.addEventListener('click', () => { drawHistory.pop(); drawMeme(); });

    memeCanvas.addEventListener('mousedown', e => {
        if (!drawingEnabled) return;
        isDrawing = true;
        [lastX, lastY] = [e.offsetX, e.offsetY];
        drawHistory.push({ color: drawColorInput.value, width: drawWidthInput.value, points: [{x:lastX,y:lastY}] });
    });

    memeCanvas.addEventListener('mousemove', e => {
        if (!isDrawing || !drawingEnabled) return;
        const path = drawHistory[drawHistory.length-1];
        if (path) {
             path.points.push({x:e.offsetX,y:e.offsetY});
        }
        drawMeme();
    });

    memeCanvas.addEventListener('mouseup', () => isDrawing=false);
    memeCanvas.addEventListener('mouseout', () => isDrawing=false);

    downloadMemeBtn.addEventListener('click', () => {
        if (!originalImage && !topTextInput.value && !bottomTextInput.value && drawHistory.length===0){
            alert('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –º–µ–º!');
            return;
        }
        const link = document.createElement('a');
        link.download = 'my-awesome-meme.png';
        link.href = memeCanvas.toDataURL('image/png');
        link.click();
    });

    drawMeme();
});
</script>
</body>  
</html> 
</html>



