<!DOCTYPE html>
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="preconnect" href="https://fonts.googleapis.com">  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>  
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Oswald:wght@500;700&display=swap" rel="stylesheet">  
    <title>MemePublishing</title>  
    <link rel="stylesheet" href="style.css">   
</head>  
<body>  
    
<header class="header-dark-style-centered" id="home">
    <div class="header-top-row">
        <div class="header-left-area">
            <a class="site-title">MEME PUBLISHING</a>
        </div>

        <div class="logo-center">
           <a href="#home" class="logo-text">#MEMEMANIA</a>
        </div>

        <div class="header-right-area">
            <nav class="nav-links-dark">
                <a href="#gallery-start">–ì–ê–õ–ï–†–ï–Ø</a>
                <a href="#generator-start">–ì–ï–ù–ï–†–ê–¢–û–†</a>
                <a href="#MemeSite" id="nav-about-link">–û –°–ê–ô–¢–ï</a>
            </nav>
            <a href="#login" class="login-button-dark">–í–û–ô–¢–ò</a>
        </div>
    </div>

    <div class="header-search-container">
        <input type="text" id="meme-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –∏–ª–∏ —Ç–µ–≥ –¥–ª—è –ø–æ–∏—Å–∫–∞...">
        <button id="search-btn">–ò—Å–∫–∞—Ç—å</button>
        <div id="search-message" class="search-message">
            –°–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. üê¶
        </div>
    </div>
</header>  

<section class="intro-section-dark">  
    <div class="intro-content-wrapper">  
          
        <div class="intro-header-content">  
            <div class="intro-text-area">  
                <h1 class="intro-hashtag">#MemeGallery</h1>  
                <p class="intro-description">  
                    –ì–∞–ª–µ—Ä–µ—è –æ—Ç–±–æ—Ä–Ω—ã—Ö –º–µ–º–æ–≤, –æ—Ç–æ–±—Ä–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ—Å—Ç–≤–æ–º.<br>  
                    –ù–∞–π–¥–∏—Ç–µ, –≤–¥–æ—Ö–Ω–æ–≤–∏—Ç–µ—Å—å –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ —Å–≤–æ–π —à–µ–¥–µ–≤—Ä.  
                </p>  
            </div>  
            <div class="filter-bar">  
                <button class="filter-btn active-filter" data-sort="views">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</button>  
                <button class="filter-btn" data-sort="likes">–õ–∞–π–∫–∏</button>
            </div>  
        </div>  
    </section>  
    
    <main class="meme-main-content">  
        <div id="gallery-start"></div>   
        <section class="meme-gallery">  
              
            <div class="meme-row">  
                <div class="meme-card" data-views="1200" data-likes="450">  
                    <img src="gallery/0u6b801ff1-1e3d4d53-c18f0260.jpg">  
                    <div class="card-footer">  
                        <span class="views">üëÅÔ∏è 1 249</span>  
                        <span class="likes">üëç 450</span>  
                    </div>  
                      
                    <div class="card-tags">  
                        <a href="#tag-cats" class="tag-link">#–ü—Å–∏—Ö–æ–ø–∞—Ç—ã—á</a>  
                        <a href="#tag-reaction" class="tag-link">#–ú–µ–º</a>  
                        <a href="#tag-classic" class="tag-link">#–°–º–µ—à–Ω—è–≤–∫–∞</a>  
                    </div>  
                </div>  

                <div class="meme-card" data-views="800" data-likes="210">  
                    <img src="gallery/images.jpeg">  
                    <div class="card-footer">  
                        <span class="views">üëÅÔ∏è 800</span>  
                        <span class="likes">üëç 489</span>  
                    </div>  
                    <div class="card-tags">  
                        <a href="#tag-dev" class="tag-link">#–ú–µ–º</a>  
                        <a href="#tag-fail" class="tag-link">#–ü—Å–µ—Ö—É—à–∫–∞</a>  
                        <a href="#tag-fail" class="tag-link">#–ü–µ—Å</a>  
                    </div>  
                </div>  
                  
                <div class="meme-card" data-views="1100" data-likes="578">  
                    <img src="gallery/images.jpg.png">  
                    <div class="card-footer">  
                        <span class="views">üëÅÔ∏è 1 238</span>  
                        <span class="likes">üëç 887</span>  
                    </div>  
                    <div class="card-tags">  
                        <a href="#tag-dev" class="tag-link">#–æ—Ä–µ—à–∫–∏ –±–∏–≥ –±–æ–±</a>  
                        <a href="#tag-fail" class="tag-link">#–ú–µ–º</a>  
                        <a href="#tag-fail" class="tag-link">#–ë–µ—à–∞–Ω–∞—è –±–µ–ª–∫–∞</a>  
                    </div>  
                </div>  
                  
                <div class="meme-card" data-views="987" data-likes="343">  
                    <img src="gallery/PolishCowMeme.jpg">  
                    <div class="card-footer">  
                        <span class="views">üëÅÔ∏è 987</span>  
                        <span class="likes">üëç 120</span>  
                    </div>  
                    <div class="card-tags">  
                        <a href="#tag-dev" class="tag-link">#–ü–æ–ª—å—Å–∫–∞—è –∫–æ—Ä–æ–≤–∞</a>  
                        <a href="#tag-fail" class="tag-link">#2022 –≥–æ–¥</a>  
                        <a href="#tag-fail" class="tag-link">#–°–º–µ—à–Ω—è–≤–∫–∞</a>  
                    </div>  
                </div>  
            </div>  
              
            <div class="meme-row hidden-row">  
                <div class="meme-card" data-views="768" data-likes="255"><img src="gallery/hehe.jpg">  
                    <div class="card-footer"><span class="views">üëÅÔ∏è 768</span><span class="likes">üëç 675</span></div>  
                    <div class="card-tags"><a href="#" class="tag-link">#–ö–æ—Ç—ã</a></div>  
                </div>  
                <div class="meme-card" data-views="555" data-likes="134"><img src="gallery/chill guy.jpeg">  
                    <div class="card-footer"><span class="views">üëÅÔ∏è 555</span><span class="likes">üëç 134</span></div>  
                    <div class="card-tags"><a href="#" class="tag-link">#—á–∏–ª–ª–æ–≤—ã–π –ø–∞—Ä–µ–Ω—å</a></div>  
                </div>  
                <div class="meme-card" data-views="2200" data-likes="1500"><img src="gallery/pesik.jpg">  
                    <div class="card-footer"><span class="views">üëÅÔ∏è 2 344</span><span class="likes">üëç 1 561</span></div>  
                    <div class="card-tags"><a href="#" class="tag-link">#–ü–µ—Å</a></div>  
                </div>  
                <div class="meme-card" data-views="3400" data-likes="2500"><img src="gallery/sozvon.jpg">  
                    <div class="card-footer"><span class="views">üëÅÔ∏è 3 433</span><span class="likes">üëç 1 478</span></div>  
                    <div class="card-tags"><a href="#" class="tag-link">#—Å–æ–∑–≤–æ–Ω</a></div>  
                </div>  
            </div>  
              
            <div class="meme-row hidden-row">  
                <div class="meme-card" data-views="947" data-likes="679"><img src="gallery/tatarstan.jpg">  
                    <div class="card-footer"><span class="views">üëÅÔ∏è 947</span><span class="likes">üëç 679</span></div>  
                    <div class="card-tags"><a href="#" class="tag-link">#–ø–æ–ø—É–≥–∞–π</a></div>  
                </div>  
                <div class="meme-card" data-views="4800" data-likes="3200"><img src="gallery/umnii.jpeg">  
                    <div class="card-footer"><span class="views">üëÅÔ∏è 4 809</span><span class="likes">üëç 2 345</span></div>  
                    <div class="card-tags"><a href="#" class="tag-link">#—É–º–Ω—ã–π —á–µ–ª–æ–≤–µ–∫ –≤ –æ—á–∫–∞—Ö</a></div>  
                </div>  
                <div class="meme-card" data-views="768" data-likes="431"><img src="gallery/shrek.jpeg">  
                    <div class="card-footer"><span class="views">üëÅÔ∏è 768</span><span class="likes">üëç 231</span></div>  
                    <div class="card-tags"><a href="#" class="tag-link">#—à—Ä–µ–∫</a></div>  
                    <div class="card-tags"><a href="#" class="tag-link">#–º–µ–∫—Å–∏–∫–∞–Ω—Å–∫–∏–π —à—Ä–µ–∫</a></div>  
                </div>  
                <div class="meme-card" data-views="1100" data-likes="900"><img src="gallery/kot.jpeg">  
                    <div class="card-footer"><span class="views">üëÅÔ∏è 1 112</span><span class="likes">üëç 900</span></div>  
                    <div class="card-tags"><a href="#" class="tag-link">#–ö–æ—Ç—ã</a></div>  
                </div>  
            </div>  
              
            <div class="meme-row hidden-row">  
                <div class="meme-card" data-views="725" data-likes="455"><img src="gallery/zhak.jpg">  
                    <div class="card-footer"><span class="views">üëÅÔ∏è 725</span><span class="likes">üëç 155</span></div>  
                    <div class="card-tags"><a href="#" class="tag-link">#–ñ–∞–∫ –§—Ä–µ—Å–∫–æ</a></div>  
                </div>  
                <div class="meme-card" data-views="2500" data-likes="1300"><img src="gallery/jarvis.jpeg">  
                    <div class="card-footer"><span class="views">üëÅÔ∏è 2 567</span><span class="likes">üëç 2 355</span></div>  
                    <div class="card-tags"><a href="#" class="tag-link">#–¥–∂–∞—Ä–≤–∏—Å</a></div>  
                </div>  
                <div class="meme-card" data-views="122" data-likes="55"><img src="gallery/lisiy.jpeg">  
                    <div class="card-footer"><span class="views">üëÅÔ∏è 122</span><span class="likes">üëç 55</span></div>  
                    <div class="card-tags"><a href="#" class="tag-link">#–ª—ã—Å—ã–π</a></div>  
                </div>  
                <div class="meme-card" data-views="1900" data-likes="1000"><img src="gallery/leto.jpeg">  
                    <div class="card-footer"><span class="views">üëÅÔ∏è 1 999</span><span class="likes">üëç 1 120</span></div>  
                    <div class="card-tags"><a href="#" class="tag-link">#—á–∏—Å—Ç–æ –Ω–∞ –ª–µ—Ç–æ</a></div>  
                </div>  
            </div>
            </section>  
    </main>  
    
    <section class="load-more-section">  
        <a href="javascript:void(0)" id="load-more-btn" class="load-more-button">  
            –ó–ê–ì–†–£–ó–ò–¢–¨ –ï–©–Å –ú–ï–ú–´  
        </a>  
    </section>  

    <div id="lightbox" class="lightbox">  
        <span class="close-btn">&times;</span>  
        <img class="lightbox-content" id="lightbox-img" src="">  
    </div>  
    <section class="generator-section" id="generator-start">  
        <div class="generator-content-wrapper">  
            <h1 class="generator-hashtag">#MemeGenerator</h1>  
              
            <div class="meme-editor-container">  
                <div class="editor-controls">  
                    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>  

                    <div class="control-group">  
                        <label for="image-upload" class="control-label">–§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</label>  
                        <input type="file" id="image-upload" accept="image/*">  
                        <button id="clear-canvas-btn" class="editor-btn delete-btn">–û—á–∏—Å—Ç–∏—Ç—å —Ö–æ–ª—Å—Ç</button>  
                    </div>  

                    <div class="control-group">  
                        <label for="top-text" class="control-label">–í–µ—Ä—Ö–Ω–∏–π —Ç–µ–∫—Å—Ç:</label>  
                        <input type="text" id="top-text" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–µ—Ä—Ö–Ω–∏–π —Ç–µ–∫—Å—Ç">  
                    </div>  

                    <div class="control-group">  
                        <label for="bottom-text" class="control-label">–ù–∏–∂–Ω–∏–π —Ç–µ–∫—Å—Ç:</label>  
                        <input type="text" id="bottom-text" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∂–Ω–∏–π —Ç–µ–∫—Å—Ç">  
                    </div>  

                    <div class="control-group text-settings">  
                        <label for="text-color" class="control-label">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞:</label>  
                        <input type="color" id="text-color" value="#FFFFFF">  
                          
                        <label for="font-size" class="control-label">–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞:</label>  
                        <input type="range" id="font-size" min="20" max="100" value="48">  
                          
                        <label for="font-family" class="control-label">–®—Ä–∏—Ñ—Ç:</label>  
                        <select id="font-family">  
                            <option value="Impact">Impact</option>  
                            <option value="Arial">Arial</option>  
                            <option value="Verdana">Verdana</option>  
                            <option value="Oswald">Oswald</option>  
                            <option value="Montserrat">Montserrat</option>  
                        </select>  
                    </div>  

                    <div class="control-group drawing-tools">  
                        <label class="control-label">–†–∏—Å–æ–≤–∞–Ω–∏–µ:</label>  
                        <div class="drawing-buttons">  
                            <button id="toggle-draw-btn" class="editor-btn draw-btn">–í–∫–ª—é—á–∏—Ç—å/–í—ã–∫–ª—é—á–∏—Ç—å</button>  
                            <input type="color" id="draw-color" value="#FF0000">  
                            <input type="range" id="draw-width" min="1" max="20" value="5">  
                            <button id="undo-draw-btn" class="editor-btn">–û—Ç–º–µ–Ω–∏—Ç—å</button>  
                        </div>  
                    </div>  

                    <div class="control-group download-group">  
                        <button id="download-meme-btn" class="editor-btn download-btn">–°–∫–∞—á–∞—Ç—å</button>  
                    </div>  
                </div>  

                <div class="canvas-area">  
                    <canvas id="memeCanvas"></canvas>  
                </div>  
            </div>  
        </div>  
    </section>

    <section id="MemeSite" class="generator-section">  
        <div class="generator-content-wrapper">  
            <h2 class="generator-hashtag">#MemeSite</h2>  
            <div class="meme-editor-container" style="display: block; padding: 30px;">  
                <p style="font-size: 18px; color: var(--text-color-secondary); margin-bottom: 15px;">  
                    –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ **MemeMania** ‚Äî –∏–¥–µ–∞–ª—å–Ω—ã–π —Å–∞–π—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–º–æ–≤!  
                </p>  
                <p style="font-size: 16px; color: var(--text-color-primary);">  
                    –Ø —Å–æ–∑–¥–∞–ª —ç—Ç—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –≤—Å–µ—Ö, –∫—Ç–æ –ª—é–±–∏—Ç –º–µ–º—ã. –ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ —Å–∞–º—ã–µ —Å–º–µ—à–Ω—ã–µ –∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ–º—ã, –Ω–æ –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —à–µ–¥–µ–≤—Ä—ã —Å –ø–æ–º–æ—â—å—é –Ω–∞—à–µ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞. –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Ç–µ–∫—Å—Ç –∏ –¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º —é–º–æ—Ä–æ–º —Å–æ –≤—Å–µ–º –º–∏—Ä–æ–º!  
                </p>  
            </div>  
        </div>  
    </section>
    
    <div id="login-modal" class="auth-modal">
        <div class="auth-modal-content">
            <span class="close-btn">&times;</span>
            
            <form id="login-form" class="auth-form">
                <h2>–í–•–û–î</h2>
                <div class="form-group">
                    <label for="user-login">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ Email</label>
                    <input type="text" id="user-login" required>
                </div>
                <div class="form-group">
                    <label for="user-password">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="user-password" required>
                </div>
                <button type="submit" class="editor-btn download-btn login-submit-btn">–í–û–ô–¢–ò</button>
                <p class="switch-link">
                    –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" id="switch-to-register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                </p>
            </form>

            <form id="register-form" class="auth-form hidden-auth-form">
                <h2>–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</h2>
                <div class="form-group">
                    <label for="reg-username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="reg-username" required>
                </div>
                 <div class="form-group">
                    <label for="reg-email">Email</label>
                    <input type="email" id="reg-email" required>
                </div>
                <div class="form-group">
                    <label for="reg-password">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="reg-password" required>
                </div>
                <button type="submit" class="editor-btn download-btn login-submit-btn">–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø</button>
                <p class="switch-link">
                    –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" id="switch-to-login">–í–æ–π—Ç–∏</a>
                </p>
            </form>
        </div>
    </div>
    <script>
document.addEventListener('DOMContentLoaded', () => {

    /* ==================================================================== */
    /* === 0. –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –°–ï–°–°–ò–ï–ô –ò UI (–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Å—Ç–æ—Ä–æ–Ω–∞) === */
    /* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç sessionStorage –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ —Å–µ—Å—Å–∏–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ AJAX */
    /* ==================================================================== */

    const getCurrentUser = () => {
        try {
            const session = sessionStorage.getItem('currentUser'); 
            return session ? JSON.parse(session) : null;
        } catch (e) {
            return null;
        }
    };

    const setCurrentUser = (user) => {
        if (user) {
            sessionStorage.setItem('currentUser', JSON.stringify(user));
        } else {
            sessionStorage.removeItem('currentUser');
        }
        updateAuthUI(); 
    };

    const updateAuthUI = () => {
        const user = getCurrentUser();
        const loginButtonArea = document.querySelector('.header-right-area');
        
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (–∫–Ω–æ–ø–∫–∞ –í–û–ô–¢–ò –∏–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å)
        const existingAuthElements = loginButtonArea.querySelectorAll('.login-button-dark, .user-profile-area, .logout-button');
        existingAuthElements.forEach(el => el.remove());

        if (user) {
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –í–û–®–ï–õ: –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–º—è/—Ä–æ–ª—å –∏ –∫–Ω–æ–ø–∫—É –í—ã—Ö–æ–¥
            const userArea = document.createElement('div');
            userArea.classList.add('user-profile-area');
            userArea.innerHTML = `
                <span class="user-welcome" style="margin-right: 15px; color: ${user.role === 'admin' ? 'var(--primary-color)' : 'var(--text-color-secondary)'}; font-weight: 700; font-size: 14px;">
                    ${user.role === 'admin' ? '–ê–î–ú–ò–ù' : user.username}
                </span>
                <a href="#" class="editor-btn download-btn logout-button" style="padding: 8px 15px; margin-left: 0;">–í–´–•–û–î</a>
            `;
            
            // –ù–∞—Ö–æ–¥–∏–º –º–µ—Å—Ç–æ, –∫—É–¥–∞ –≤—Å—Ç–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã (–ø–æ—Å–ª–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫)
            const navLinks = loginButtonArea.querySelector('.nav-links-dark');
            loginButtonArea.insertBefore(userArea, navLinks.nextSibling);

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã—Ö–æ–¥–∞
            document.querySelector('.logout-button').addEventListener('click', (e) => {
                e.preventDefault();
                setCurrentUser(null);
            });

        } else {
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –í–û–®–ï–õ: –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–Ω–æ–ø–∫—É –í–û–ô–¢–ò
            const loginBtn = document.createElement('a');
            loginBtn.href = "#";
            loginBtn.classList.add('login-button-dark');
            loginBtn.textContent = '–í–û–ô–¢–ò';
            loginButtonArea.appendChild(loginBtn);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            loginBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const loginModal = document.getElementById('login-modal');
                const loginForm = document.getElementById('login-form');
                const registerForm = document.getElementById('register-form');

                if (loginModal) {
                    if(loginForm) loginForm.classList.remove('hidden-auth-form');
                    if(registerForm) registerForm.classList.add('hidden-auth-form');
                    loginModal.style.display = "flex";
                }
            });
        }
    };
    
    // ====================================================================

    /* === –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø –ü–õ–ê–í–ù–ê–Ø –ü–†–û–ö–†–£–¢–ö–ê === */
    document.querySelectorAll('a[href^="#"]').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            if (!targetId || targetId === '#' || targetId === '#home') {
                window.scrollTo({ top: 0, behavior: 'smooth' });
                return;
            }
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    });
    // ====================================================================


    /* ==================================================================== */
    /* === 1. –õ–û–ì–ò–ö–ê –û–ö–ù–ê –í–•–û–î–ê/–†–ï–ì–ò–°–¢–†–ê–¶–ò–ò (–§—Ä–æ–Ω—Ç–µ–Ω–¥) === */
    /* ==================================================================== */
    
    const loginModal = document.getElementById('login-modal');
    const loginCloseBtn = loginModal ? loginModal.querySelector('.close-btn') : null; 

    // –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const switchToRegisterLink = document.getElementById('switch-to-register');
    const switchToLoginLink = document.getElementById('switch-to-login');

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫—Ä–µ—Å—Ç–∏–∫—É
    if (loginCloseBtn) {
        loginCloseBtn.addEventListener('click', () => {
            if(loginModal) loginModal.style.display = "none";
        });
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    window.addEventListener('click', e => {
        if (e.target === loginModal) {
            loginModal.style.display = "none";
        }
    });

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞–º–∏
    if (switchToRegisterLink && loginForm && registerForm) {
        switchToRegisterLink.addEventListener('click', (e) => {
            e.preventDefault();
            loginForm.classList.add('hidden-auth-form');
            registerForm.classList.remove('hidden-auth-form');
        });
    }
    if (switchToLoginLink && loginForm && registerForm) {
        switchToLoginLink.addEventListener('click', (e) => {
            e.preventDefault();
            registerForm.classList.add('hidden-auth-form');
            loginForm.classList.remove('hidden-auth-form');
        });
    }


    /* ==================================================================== */
    /* === 2. –û–ë–†–ê–ë–û–¢–ö–ê –§–û–†–ú (AJAX –∫ api.php) === */
    /* ==================================================================== */
    
    // --- 2.1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –í–•–û–î–ê (LOGIN) ---
    if (loginForm) {
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const userLogin = document.getElementById('user-login').value;
            const userPassword = document.getElementById('user-password').value;
            
            try {
                const response = await fetch('api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'login',
                        login: userLogin,
                        password: userPassword
                    })
                });
                
                const result = await response.json();

                if (result.success) {
                    setCurrentUser(result.user); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é –∏ –æ–±–Ω–æ–≤–ª—è–µ–º UI
                    loginModal.style.display = "none";
                    alert(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${result.user.role === 'admin' ? '–ê–¥–º–∏–Ω' : result.user.username}!`);
                    loginForm.reset();
                } else {
                    alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + (result.message || '–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.'));
                }
            } catch (error) {
                console.error('Login failed:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–µ—Ä—É. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PHP –∑–∞–ø—É—â–µ–Ω –∏ —Ñ–∞–π–ª—ã api.php/db.php –¥–æ—Å—Ç—É–ø–Ω—ã.');
            }
        });
    }
    
    // --- 2.2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò (REGISTER) ---
    if (registerForm) {
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const regUsername = document.getElementById('reg-username').value.trim();
            const regEmail = document.getElementById('reg-email').value.trim();
            const regPassword = document.getElementById('reg-password').value;

            try {
                const response = await fetch('api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'register',
                        username: regUsername,
                        email: regEmail,
                        password: regPassword
                    })
                });

                const result = await response.json();

                if (result.success) {
                    setCurrentUser(result.user); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥
                    loginModal.style.display = "none";
                    alert(`–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${result.user.username}!`);
                    registerForm.reset();
                } else {
                    alert('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + (result.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.'));
                }

            } catch (error) {
                console.error('Registration failed:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–µ—Ä—É. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PHP –∑–∞–ø—É—â–µ–Ω –∏ —Ñ–∞–π–ª—ã api.php/db.php –¥–æ—Å—Ç—É–ø–Ω—ã.');
            }
        });
    }


    /* === –ì–∞–ª–µ—Ä–µ—è (–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) === */
    const galleryContainer = document.querySelector('.meme-gallery');
    const loadMoreBtn = document.getElementById('load-more-btn');
    const allCardsArray = Array.from(document.querySelectorAll('.meme-card'));
    const cardsPerRow = 4;
    const totalRows = Math.ceil(allCardsArray.length / cardsPerRow);
    const rowsPerClick = 2;
    let currentVisibleRows = 1;
    let currentSort = document.querySelector('.filter-btn.active-filter')?.dataset.sort || 'views';

    const rebuildGallery = (sortBy, rowsToKeepVisible) => {
        allCardsArray.sort((a, b) => parseInt(b.dataset[sortBy]) - parseInt(a.dataset[sortBy]));
        galleryContainer.innerHTML = '';
        const rowsToShow = Math.min(rowsToKeepVisible, totalRows);

        for (let i = 0; i < totalRows; i++) {
            const newRow = document.createElement('div');
            newRow.classList.add('meme-row');
            if (i >= rowsToShow) newRow.classList.add('hidden-row');
            allCardsArray.slice(i * cardsPerRow, i * cardsPerRow + cardsPerRow)
                         .forEach(card => newRow.appendChild(card));
            galleryContainer.appendChild(newRow);
        }

        if (loadMoreBtn) {
            if (rowsToShow >= totalRows) loadMoreBtn.classList.add('hidden');
            else loadMoreBtn.classList.remove('hidden');
        }
    };

    if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', () => {
            currentVisibleRows += rowsPerClick;
            rebuildGallery(currentSort, currentVisibleRows);
        });
    }

    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active-filter'));
            btn.classList.add('active-filter');
            currentSort = btn.dataset.sort;
            currentVisibleRows = 1;
            rebuildGallery(currentSort, currentVisibleRows);
        });
    });

    rebuildGallery(currentSort, currentVisibleRows);

    /* === Lightbox (–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) === */
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightbox-img");
    const closeBtn = document.querySelector("#lightbox .close-btn"); // –£—Ç–æ—á–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä

    allCardsArray.forEach(card => {
        const img = card.querySelector('img');
        img.addEventListener('click', () => {
            lightbox.style.display = "flex";
            lightboxImg.src = img.src;
        });
    });

    if (closeBtn) {
        closeBtn.addEventListener('click', () => lightbox.style.display = "none");
    }
    
    window.addEventListener('click', e => {
        if (e.target === lightbox) lightbox.style.display = "none";
    });

    /* === –ü–æ–∏—Å–∫ (–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) === */
    const searchInput = document.getElementById('meme-search');
    const searchBtn = document.getElementById('search-btn');
    const searchMessage = document.getElementById('search-message');

    const showSearchMessage = () => {
        searchMessage.classList.add('visible');
        setTimeout(() => searchMessage.classList.remove('visible'), 1000);
    };

    const executeSearch = () => {
        const query = searchInput.value.trim().toLowerCase().replace(/#/g, '');
        searchMessage.classList.remove('visible'); 
        if (!query) return;

        let foundCard = null;
        let foundTag = null;

        for (const card of allCardsArray) {
            const tags = card.querySelectorAll('.tag-link');
            for (const tag of tags) {
                if (tag.textContent.toLowerCase().replace(/#/g, '').includes(query)) {
                    foundCard = card;
                    foundTag = tag;
                    break;
                }
            }
            if (foundCard) break;
        }

        if (foundCard) {
            const index = allCardsArray.indexOf(foundCard);
            const rowsNeeded = Math.ceil((index + 1) / cardsPerRow);
            if (rowsNeeded > currentVisibleRows) {
                currentVisibleRows = rowsNeeded;
                rebuildGallery(currentSort, currentVisibleRows);
            }

            setTimeout(() => {
                (foundTag || foundCard).scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        } else showSearchMessage();
    };

    searchBtn.addEventListener('click', executeSearch);
    searchInput.addEventListener('keydown', e => { if (e.key === 'Enter') executeSearch(); });

    /* === –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–µ–º–æ–≤ (Canvas) (–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) === */
    const memeCanvas = document.getElementById('memeCanvas');
    const ctx = memeCanvas.getContext('2d');
    const imageUpload = document.getElementById('image-upload');
    const clearCanvasBtn = document.getElementById('clear-canvas-btn');
    const topTextInput = document.getElementById('top-text');
    const bottomTextInput = document.getElementById('bottom-text');
    const textColorInput = document.getElementById('text-color');
    const fontSizeInput = document.getElementById('font-size');
    const fontFamilySelect = document.getElementById('font-family');
    const toggleDrawBtn = document.getElementById('toggle-draw-btn');
    const drawColorInput = document.getElementById('draw-color');
    const drawWidthInput = document.getElementById('draw-width');
    const undoDrawBtn = document.getElementById('undo-draw-btn');
    const downloadMemeBtn = document.getElementById('download-meme-btn');

    let originalImage = null, drawHistory = [], drawingEnabled = false, isDrawing = false, lastX = 0, lastY = 0;

    memeCanvas.width = 600;
    memeCanvas.height = 400;

    const drawMeme = () => {
        ctx.clearRect(0, 0, memeCanvas.width, memeCanvas.height);

        if (originalImage) {
            let w = originalImage.width, h = originalImage.height;
            const ratio = w / h;
            const maxW = 800, maxH = 600;

            if (w > maxW || h > maxH) {
                if (w / maxW > h / maxH) {
                    w = maxW;
                    h = w / ratio;
                } else {
                    h = maxH;
                    w = h * ratio;
                }
            } else {
                if (originalImage.width > maxW) { w = maxW; h = w / ratio; }
                if (originalImage.height > maxH) { h = maxH; w = h * ratio; }
            }
            
            memeCanvas.width = w;
            memeCanvas.height = h;

            const x = 0; 
            const y = 0;
            ctx.drawImage(originalImage, x, y, w, h);
        } else {
            memeCanvas.width = 600;
            memeCanvas.height = 400;
        }


        // –†–∏—Å–æ–≤–∞–Ω–∏–µ
        drawHistory.forEach(path => {
            ctx.strokeStyle = path.color;
            ctx.lineWidth = path.width;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.beginPath();
            if (path.points.length > 0) {
                 ctx.moveTo(path.points[0].x, path.points[0].y);
                 path.points.forEach(p => ctx.lineTo(p.x, p.y));
            }
            ctx.stroke();
        });

        // –¢–µ–∫—Å—Ç
        ctx.font = `bold ${fontSizeInput.value}px ${fontFamilySelect.value}`;
        ctx.fillStyle = textColorInput.value;
        ctx.strokeStyle = 'black';
        ctx.lineWidth = parseInt(fontSizeInput.value) / 16;
        ctx.textAlign = 'center';

        // –í–µ—Ä—Ö–Ω–∏–π —Ç–µ–∫—Å—Ç (—Å –æ–±–≤–æ–¥–∫–æ–π)
        if (topTextInput.value) {
            ctx.strokeText(topTextInput.value, memeCanvas.width / 2, parseInt(fontSizeInput.value) + 20);
            ctx.fillText(topTextInput.value, memeCanvas.width / 2, parseInt(fontSizeInput.value) + 20);
        }
        
        // –ù–∏–∂–Ω–∏–π —Ç–µ–∫—Å—Ç (—Å –æ–±–≤–æ–¥–∫–æ–π)
        if (bottomTextInput.value) {
            ctx.strokeText(bottomTextInput.value, memeCanvas.width / 2, memeCanvas.height - 20);
            ctx.fillText(bottomTextInput.value, memeCanvas.width / 2, memeCanvas.height - 20);
        }
    };

    imageUpload.addEventListener('change', e => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = ev => {
            const img = new Image();
            img.onload = () => { originalImage = img; drawHistory = []; drawMeme(); };
            img.src = ev.target.result;
        };
        reader.readAsDataURL(file);
    });

    clearCanvasBtn.addEventListener('click', () => { originalImage = null; drawHistory = []; drawMeme(); });
    topTextInput.addEventListener('input', drawMeme);
    bottomTextInput.addEventListener('input', drawMeme);
    textColorInput.addEventListener('input', drawMeme);
    fontSizeInput.addEventListener('input', drawMeme);
    fontFamilySelect.addEventListener('change', drawMeme);

    toggleDrawBtn.addEventListener('click', () => {
        drawingEnabled = !drawingEnabled;
        toggleDrawBtn.classList.toggle('active-draw', drawingEnabled);
        memeCanvas.style.cursor = drawingEnabled ? 'crosshair' : 'default';
        isDrawing = false;
    });

    undoDrawBtn.addEventListener('click', () => { drawHistory.pop(); drawMeme(); });

    memeCanvas.addEventListener('mousedown', e => {
        if (!drawingEnabled) return;
        isDrawing = true;
        [lastX, lastY] = [e.offsetX, e.offsetY];
        drawHistory.push({ color: drawColorInput.value, width: drawWidthInput.value, points: [{x:lastX,y:lastY}] });
    });

    memeCanvas.addEventListener('mousemove', e => {
        if (!isDrawing || !drawingEnabled) return;
        const path = drawHistory[drawHistory.length-1];
        if (path) {
             path.points.push({x:e.offsetX,y:e.offsetY});
        }
        drawMeme();
    });

    memeCanvas.addEventListener('mouseup', () => isDrawing=false);
    memeCanvas.addEventListener('mouseout', () => isDrawing=false);

    downloadMemeBtn.addEventListener('click', () => {
        if (!originalImage && !topTextInput.value && !bottomTextInput.value && drawHistory.length===0){
            alert('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –º–µ–º!');
            return;
        }
        const link = document.createElement('a');
        link.download = 'my-awesome-meme.png';
        link.href = memeCanvas.toDataURL('image/png');
        link.click();
    });

    // --- –§–ò–ù–ê–õ–ò–ó–ê–¶–ò–Ø ---
    drawMeme();
    updateAuthUI(); // –í—ã–∑—ã–≤–∞–µ–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Å—Å–∏–∏ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–Ω–æ–ø–∫–∏
});
</script>
</body>  
</html>


